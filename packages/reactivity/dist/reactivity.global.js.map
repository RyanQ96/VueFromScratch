{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export { effect } from \"./effect\"\nexport { reactive } from \"./reactive\"", "export let activeEffect = undefined\nexport class ReactiveEffect {\n  public active = true\n  public fn\n  public parent = null\n  public deps = new Set()\n  constructor(fn) { //\u4F20\u9012\u7684fn\u4F1A\u88AB\u653E\u5728fn\u4E0A\n    this.fn = fn\n  }\n  run() {\n    if (!this.active) {\n      return this.fn() \n    } else {\n      // dependencies tracking \n      try {\n        this.parent = activeEffect\n        activeEffect = this\n        this.fn()\n      } finally {\n        activeEffect = this.parent\n        this.parent = null\n      }\n    }\n  }\n}\n\nexport function effect(fn) {\n  const _effect = new ReactiveEffect(fn)\n  _effect.run()\n}\n\n\nconst targetMap = new WeakMap() \n// map {object: {key: [effect, effect2....]}}\nexport function track(target, key) {\n  if (activeEffect) {\n    let depsMap = targetMap.get(target) \n    if (!depsMap) {\n      targetMap.set(target, (depsMap = new Map()))  \n    }\n    let deps = depsMap.get(key) \n    if (!deps) {\n      depsMap.set(key, (deps = new Set()))\n    }\n    const shouldTrack = !deps.has(activeEffect) \n    if (shouldTrack) {\n      deps.add(activeEffect)\n      if (!activeEffect.deps.has(deps)) {\n        activeEffect.deps.add(deps)\n      }\n    }\n  }\n}\n\nexport function trigger(target, key, value) {\n  let depsMap = targetMap.get(target) \n  if (!depsMap) return  // key doesn't reply on any effect \n  const effects = depsMap.get(key) \n  effects && effects.forEach(effect => {\n    effect.run() // re-execute effect\n  })\n}\n", "export const isObject = (value) => {\n  return typeof value === 'object' && value !== null\n}", "import { track, trigger } from \"./effect\";\nexport const enum  ReactiveFlags {\n  IS_REACTIVE = '__v_isReactive'\n}\nexport const baseHandler = {\n  get(target, key, receiver) {\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      return true\n    } else {\n      // relate key and effect\n      track(target, key)\n      console.log(`logging: collect dependency for key: ${String(key)}`)\n      return Reflect.get(target, key, receiver)\n    }\n  },\n  set(target, key, value, receiver) {\n    // based on key, find which effects need to change \n    let oldValue = target[key] \n\n    if (oldValue != value) {\n      let result = Reflect.set(target, key, value, receiver)\n      trigger(target, key, value) \n      return result; \n    }\n  }\n} \n", "import { isObject } from \"@vue/shared\";\nimport { activeEffect } from \"./effect\";\nimport { baseHandler, ReactiveFlags } from \"./baseHandler\";\nconst reactiveMap = new WeakMap(); // key of weakmap has to be an object\n// v8's gabage collection mechanism \n\nexport function reactive(target) {\n  if (!isObject(target)) {\n    return target\n  }\n\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target\n  }\n\n  const existing = reactiveMap.get(target)\n  if (existing) {\n    return existing\n  }\n\n  const proxy = new Proxy(target, baseHandler)\n\n  reactiveMap.set(target, proxy)\n  return proxy\n}\n\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAO,MAAI,eAAe;AACnB,MAAM,iBAAN,MAAqB;AAAA,IAK1B,YAAY,IAAI;AAJhB,WAAO,SAAS;AAEhB,WAAO,SAAS;AAChB,WAAO,OAAO,oBAAI,IAAI;AAEpB,WAAK,KAAK;AAAA,IACZ;AAAA,IACA,MAAM;AACJ,UAAI,CAAC,KAAK,QAAQ;AAChB,eAAO,KAAK,GAAG;AAAA,MACjB,OAAO;AAEL,YAAI;AACF,eAAK,SAAS;AACd,yBAAe;AACf,eAAK,GAAG;AAAA,QACV,UAAE;AACA,yBAAe,KAAK;AACpB,eAAK,SAAS;AAAA,QAChB;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEO,WAAS,OAAO,IAAI;AACzB,UAAM,UAAU,IAAI,eAAe,EAAE;AACrC,YAAQ,IAAI;AAAA,EACd;AAGA,MAAM,YAAY,oBAAI,QAAQ;AAEvB,WAAS,MAAM,QAAQ,KAAK;AACjC,QAAI,cAAc;AAChB,UAAI,UAAU,UAAU,IAAI,MAAM;AAClC,UAAI,CAAC,SAAS;AACZ,kBAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,MAC7C;AACA,UAAI,OAAO,QAAQ,IAAI,GAAG;AAC1B,UAAI,CAAC,MAAM;AACT,gBAAQ,IAAI,KAAM,OAAO,oBAAI,IAAI,CAAE;AAAA,MACrC;AACA,YAAM,cAAc,CAAC,KAAK,IAAI,YAAY;AAC1C,UAAI,aAAa;AACf,aAAK,IAAI,YAAY;AACrB,YAAI,CAAC,aAAa,KAAK,IAAI,IAAI,GAAG;AAChC,uBAAa,KAAK,IAAI,IAAI;AAAA,QAC5B;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEO,WAAS,QAAQ,QAAQ,KAAK,OAAO;AAC1C,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAI,CAAC;AAAS;AACd,UAAM,UAAU,QAAQ,IAAI,GAAG;AAC/B,eAAW,QAAQ,QAAQ,CAAAA,YAAU;AACnC,MAAAA,QAAO,IAAI;AAAA,IACb,CAAC;AAAA,EACH;;;AC7DO,MAAM,WAAW,CAAC,UAAU;AACjC,WAAO,OAAO,UAAU,YAAY,UAAU;AAAA,EAChD;;;ACEO,MAAM,cAAc;AAAA,IACzB,IAAI,QAAQ,KAAK,UAAU;AACzB,UAAI,QAAQ,oCAA2B;AACrC,eAAO;AAAA,MACT,OAAO;AAEL,cAAM,QAAQ,GAAG;AACjB,gBAAQ,IAAI,wCAAwC,OAAO,GAAG,GAAG;AACjE,eAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,MAC1C;AAAA,IACF;AAAA,IACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAEhC,UAAI,WAAW,OAAO;AAEtB,UAAI,YAAY,OAAO;AACrB,YAAI,SAAS,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AACrD,gBAAQ,QAAQ,KAAK,KAAK;AAC1B,eAAO;AAAA,MACT;AAAA,IACF;AAAA,EACF;;;ACtBA,MAAM,cAAc,oBAAI,QAAQ;AAGzB,WAAS,SAAS,QAAQ;AAC/B,QAAI,CAAC,SAAS,MAAM,GAAG;AACrB,aAAO;AAAA,IACT;AAEA,QAAI,4CAAmC;AACrC,aAAO;AAAA,IACT;AAEA,UAAM,WAAW,YAAY,IAAI,MAAM;AACvC,QAAI,UAAU;AACZ,aAAO;AAAA,IACT;AAEA,UAAM,QAAQ,IAAI,MAAM,QAAQ,WAAW;AAE3C,gBAAY,IAAI,QAAQ,KAAK;AAC7B,WAAO;AAAA,EACT;",
  "names": ["effect"]
}
